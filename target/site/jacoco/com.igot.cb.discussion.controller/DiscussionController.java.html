<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DiscussionController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">cb-discussion-service</a> &gt; <a href="index.source.html" class="el_package">com.igot.cb.discussion.controller</a> &gt; <span class="el_source">DiscussionController.java</span></div><h1>DiscussionController.java</h1><pre class="source lang-java linenums">package com.igot.cb.discussion.controller;
import com.fasterxml.jackson.databind.JsonNode;
import com.igot.cb.discussion.service.AnswerPostReplyService;
import com.igot.cb.discussion.service.DiscussionService;
import com.igot.cb.pores.elasticsearch.dto.SearchCriteria;
import com.igot.cb.pores.util.ApiResponse;
import com.igot.cb.pores.util.Constants;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import java.util.Map;

@RestController
@RequestMapping(&quot;/v1/discussion&quot;)
<span class="fc" id="L18">public class DiscussionController {</span>

    @Autowired
    DiscussionService discussionService;

    @Autowired
    AnswerPostReplyService answerPostReplyService;

    @PostMapping(&quot;/create&quot;)
    public ResponseEntity&lt;ApiResponse&gt; createDiscussion(@RequestBody JsonNode discussionDetails,
                                                           @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L29">        ApiResponse response = discussionService.createDiscussion(discussionDetails,token);</span>
<span class="fc" id="L30">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @GetMapping(&quot;/read/{discussionId}&quot;)
    public ResponseEntity&lt;ApiResponse&gt; readDiscussion(@PathVariable String discussionId) {
<span class="fc" id="L35">        ApiResponse response = discussionService.readDiscussion(discussionId);</span>
<span class="fc" id="L36">        return new ResponseEntity&lt;&gt;(response,response.getResponseCode());</span>
    }

    @PostMapping(&quot;/update&quot;)
    public ResponseEntity&lt;ApiResponse&gt; updateDiscussion(@RequestBody JsonNode updateData,
                                                           @RequestHeader(Constants.X_AUTH_TOKEN) String token){
<span class="fc" id="L42">        ApiResponse response = discussionService.updateDiscussion(updateData,token);</span>
<span class="fc" id="L43">        return new ResponseEntity&lt;&gt;(response,response.getResponseCode());</span>
    }

    @PostMapping(&quot;/search&quot;)
    public ResponseEntity&lt;ApiResponse&gt; searchDiscussion(@RequestBody SearchCriteria searchCriteria){
<span class="fc" id="L48">        ApiResponse response = discussionService.searchDiscussion(searchCriteria, false);</span>
<span class="fc" id="L49">        return new ResponseEntity&lt;&gt;(response,response.getResponseCode());</span>
    }

    @DeleteMapping(&quot;/question/delete/{discussionId}&quot;)
    public ResponseEntity&lt;ApiResponse&gt; deletePost(@PathVariable String discussionId,
                                                           @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L55">        ApiResponse response = discussionService.deleteDiscussion(discussionId,Constants.QUESTION, token);</span>
<span class="fc" id="L56">        return new ResponseEntity&lt;&gt;(response, HttpStatus.OK);</span>
    }

    @PostMapping(&quot;/answerPosts&quot;)
    public ResponseEntity&lt;ApiResponse&gt; answerPost(@RequestBody JsonNode answerPostData,
                                                  @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L62">        ApiResponse response = discussionService.createAnswerPost(answerPostData, token);</span>
<span class="fc" id="L63">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @PostMapping(&quot;/question/like/{discussionId}&quot;)
    public ResponseEntity&lt;ApiResponse&gt; postLike(@PathVariable String discussionId,
                                              @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L69">        ApiResponse response = discussionService.upVote(discussionId,Constants.QUESTION, token);</span>
<span class="fc" id="L70">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @PostMapping(&quot;/question/dislike/{discussionId}&quot;)
    public ResponseEntity&lt;ApiResponse&gt; postDislike(@PathVariable String discussionId,
                                                @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L76">        ApiResponse response = discussionService.downVote(discussionId, Constants.QUESTION, token);</span>
<span class="fc" id="L77">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @PostMapping(&quot;/report&quot;)
    public ResponseEntity&lt;ApiResponse&gt; report(@RequestBody Map&lt;String, Object&gt; reportData,
                                               @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L83">        ApiResponse response = discussionService.report(token, reportData);</span>
<span class="fc" id="L84">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @PostMapping(&quot;/fileUpload/{communityId}/{discussionId}&quot;)
    public ResponseEntity&lt;ApiResponse&gt; uploadFile(
            @RequestParam(value = &quot;file&quot;, required = true) MultipartFile multipartFile,
            @PathVariable(value = &quot;communityId&quot;, required = true) String communityId,
            @PathVariable(value = &quot;discussionId&quot;, required = true) String discussionId)  {
<span class="fc" id="L92">        ApiResponse uploadResponse = discussionService.uploadFile(multipartFile, communityId,discussionId);</span>
<span class="fc" id="L93">        return new ResponseEntity&lt;&gt;(uploadResponse, uploadResponse.getResponseCode());</span>
    }

    @PostMapping(&quot;/updateAnswerPost&quot;)
    public ResponseEntity&lt;ApiResponse&gt; updateAnswerPost(@RequestBody JsonNode updateData,
                                                        @RequestHeader(Constants.X_AUTH_TOKEN) String token){
<span class="fc" id="L99">        ApiResponse response = discussionService.updateAnswerPost(updateData,token);</span>
<span class="fc" id="L100">        return new ResponseEntity&lt;&gt;(response,response.getResponseCode());</span>
    }

    @GetMapping(&quot;/bookmark/{communityId}/{discussionId}&quot;)
    public ResponseEntity&lt;ApiResponse&gt; bookmarkDiscussion(@PathVariable String communityId, @PathVariable String discussionId,
                                                          @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L106">        ApiResponse response = discussionService.bookmarkDiscussion(token, communityId, discussionId);</span>
<span class="fc" id="L107">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @PostMapping(&quot;/unBookmark/{communityId}/{discussionId}&quot;)
    public ResponseEntity&lt;ApiResponse&gt; unBookmarkDiscussion(@PathVariable String communityId, @PathVariable String discussionId,
                                                           @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L113">        ApiResponse response = discussionService.unBookmarkDiscussion(communityId, discussionId, token);</span>
<span class="fc" id="L114">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @PostMapping(&quot;/bookmarkedDiscussions&quot;)
    public ResponseEntity&lt;ApiResponse&gt; getBookmarkedDiscussions(@RequestBody Map&lt;String, Object&gt; getBookmarkedPostsData,
                                                                @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L120">        ApiResponse response = discussionService.getBookmarkedDiscussions(token,getBookmarkedPostsData);</span>
<span class="fc" id="L121">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @PostMapping(&quot;/communityFeed&quot;)
    public ResponseEntity&lt;ApiResponse&gt; searchDiscussionByCommunity(@RequestBody Map&lt;String, Object&gt; searchData) {
<span class="fc" id="L126">        ApiResponse response = discussionService.searchDiscussionByCommunity(searchData);</span>
<span class="fc" id="L127">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @DeleteMapping(&quot;/answerPost/delete/{discussionId}&quot;)
    public ResponseEntity&lt;ApiResponse&gt; deleteAnswerPost(@PathVariable String discussionId,
                                                        @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L133">        ApiResponse response = discussionService.deleteDiscussion(discussionId, Constants.ANSWER_POST, token);</span>
<span class="fc" id="L134">        return new ResponseEntity&lt;&gt;(response, HttpStatus.OK);</span>
    }

    @PostMapping(&quot;/answerPost/like/{discussionId}&quot;)
    public ResponseEntity&lt;ApiResponse&gt; answerPostLike(@PathVariable String discussionId,
                                                      @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L140">        ApiResponse response = discussionService.upVote(discussionId, Constants.ANSWER_POST, token);</span>
<span class="fc" id="L141">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @PostMapping(&quot;/answerPost/dislike/{discussionId}&quot;)
    public ResponseEntity&lt;ApiResponse&gt; answerPostDislike(@PathVariable String discussionId,
                                                         @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L147">        ApiResponse response = discussionService.downVote(discussionId, Constants.ANSWER_POST, token);</span>
<span class="fc" id="L148">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @PostMapping(&quot;/enrichData&quot;)
    public ResponseEntity&lt;ApiResponse&gt; enrichDiscussionData(@RequestBody Map&lt;String, Object&gt; searchData,  @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L153">        ApiResponse response = discussionService.getEnrichedDiscussionData(searchData, token);</span>
<span class="fc" id="L154">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @PostMapping(&quot;/globalFeed&quot;)
    public ResponseEntity&lt;ApiResponse&gt; getGlobalFeed(@RequestBody SearchCriteria searchCriteria,
                                                     @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L160">        ApiResponse response = discussionService.getGlobalFeed(searchCriteria, token, false);</span>
<span class="fc" id="L161">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @PostMapping(&quot;/answerPostReply/create&quot;)
    public ResponseEntity&lt;ApiResponse&gt; createAnswerPostReply(@RequestBody JsonNode answerPostReplyData,
                                                             @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L167">        ApiResponse response = answerPostReplyService.createAnswerPostReply(answerPostReplyData, token);</span>
<span class="fc" id="L168">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @GetMapping(&quot;/answerPostReply/read/{discussionId}&quot;)
    public ResponseEntity&lt;ApiResponse&gt; readAnswerPostReply(@PathVariable String discussionId) {
<span class="fc" id="L173">        ApiResponse response = answerPostReplyService.readAnswerPostReply(discussionId);</span>
<span class="fc" id="L174">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @PostMapping(&quot;/answerPostReply/update&quot;)
    public ResponseEntity&lt;ApiResponse&gt; updateAnswerPostReply(@RequestBody JsonNode updateData,
                                                             @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L180">        ApiResponse response = answerPostReplyService.updateAnswerPostReply(updateData, token);</span>
<span class="fc" id="L181">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @DeleteMapping(&quot;/answerPostReply/delete/{discussionId}&quot;)
    public ResponseEntity&lt;ApiResponse&gt; deleteAnswerPostReply(@PathVariable String discussionId,
                                                             @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L187">        ApiResponse response = answerPostReplyService.deleteAnswerPostReply(discussionId, Constants.ANSWER_POST_REPLY, token);</span>
<span class="fc" id="L188">        return new ResponseEntity&lt;&gt;(response, HttpStatus.OK);</span>
    }

    @PostMapping(&quot;/answerPostReply/like/{discussionId}&quot;)
    public ResponseEntity&lt;ApiResponse&gt; AnswerPostReplyLike(@PathVariable String discussionId,
                                                           @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L194">        ApiResponse response = discussionService.upVote(discussionId, Constants.ANSWER_POST_REPLY, token);</span>
<span class="fc" id="L195">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @PostMapping(&quot;/answerPostReply/dislike/{discussionId}&quot;)
    public ResponseEntity&lt;ApiResponse&gt; AnswerPostReplyDislike(@PathVariable String discussionId,
                                                              @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L201">        ApiResponse response = discussionService.downVote(discussionId, Constants.ANSWER_POST_REPLY, token);</span>
<span class="fc" id="L202">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @PostMapping(&quot;/admin/removePost&quot;)
    public ResponseEntity&lt;ApiResponse&gt; removePost(@RequestBody Map&lt;String, Object&gt; reportData,
                                                  @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L208">        ApiResponse response = answerPostReplyService.managePost(reportData, token, Constants.SUSPEND);</span>
<span class="fc" id="L209">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @PostMapping(&quot;/admin/activatePost&quot;)
    public ResponseEntity&lt;ApiResponse&gt; activatePost(@RequestBody Map&lt;String, Object&gt; reportData,
                                                    @RequestHeader(Constants.X_AUTH_TOKEN) String token) {
<span class="fc" id="L215">        ApiResponse response = answerPostReplyService.managePost(reportData, token, Constants.ACTIVE);</span>
<span class="fc" id="L216">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @PostMapping(&quot;/getReportStatistics&quot;)
    public ResponseEntity&lt;ApiResponse&gt; getReportStatistics(@RequestBody Map&lt;String, Object&gt; getReportData) {
<span class="fc" id="L221">        ApiResponse response = answerPostReplyService.getReportStatistics(getReportData);</span>
<span class="fc" id="L222">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }

    @GetMapping(&quot;/migrateRecentReportedTime&quot;)
    public ResponseEntity&lt;ApiResponse&gt; migrateRecentReportedTime() {
<span class="fc" id="L227">        ApiResponse response = answerPostReplyService.migrateRecentReportedTime();</span>
<span class="fc" id="L228">        return new ResponseEntity&lt;&gt;(response, response.getResponseCode());</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>