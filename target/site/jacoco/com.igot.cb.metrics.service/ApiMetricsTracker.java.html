<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ApiMetricsTracker.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">cb-discussion-service</a> &gt; <a href="index.source.html" class="el_package">com.igot.cb.metrics.service</a> &gt; <span class="el_source">ApiMetricsTracker.java</span></div><h1>ApiMetricsTracker.java</h1><pre class="source lang-java linenums">package com.igot.cb.metrics.service;

import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

<span class="nc" id="L7">public class ApiMetricsTracker {</span>

    // Centralized map to store metrics for each API endpoint
<span class="fc" id="L10">    private static final Map&lt;String, ApiMetrics&gt; apiMetricsMap = new ConcurrentHashMap&lt;&gt;();</span>
<span class="fc" id="L11">    private static boolean trackingEnabled = false;</span>

    public static void enableTracking() {
<span class="fc" id="L14">        trackingEnabled = true;</span>
<span class="fc" id="L15">    }</span>

    public static void disableTracking() {
<span class="fc" id="L18">        trackingEnabled = false;</span>
<span class="fc" id="L19">    }</span>

    public static boolean isTrackingEnabled() {
<span class="fc" id="L22">        return trackingEnabled;</span>
    }

    /**
     * Records an API call.
     *
     * @param apiEndpoint The API endpoint being tracked.
     */
    public static void recordApiCall(String apiEndpoint) {
<span class="fc" id="L31">        ApiMetrics apiMetrics = apiMetricsMap.computeIfAbsent(apiEndpoint, k -&gt; new ApiMetrics());</span>
<span class="fc" id="L32">        apiMetrics.incrementApiCallCount();</span>
<span class="fc" id="L33">    }</span>

    /**
     * Records a database operation's metrics.
     *
     * @param apiEndpoint The API endpoint being tracked.
     * @param dbName      The name of the database (e.g., &quot;cassandra&quot;, &quot;redis&quot;).
     * @param operation   The operation performed (e.g., &quot;insert&quot;, &quot;read&quot;).
     * @param timeTaken   The time taken for the operation in milliseconds.
     */
    public static void recordDbOperation(String apiEndpoint, String dbName, String operation, long timeTaken) {
<span class="fc" id="L44">        ApiMetrics apiMetrics = apiMetricsMap.computeIfAbsent(apiEndpoint, k -&gt; new ApiMetrics());</span>
<span class="fc" id="L45">        DbMetrics dbMetrics = apiMetrics.getDbMetricsMap().computeIfAbsent(dbName, k -&gt; new DbMetrics());</span>

        // Update counts and times for the operation
<span class="fc" id="L48">        dbMetrics.getOperationCounts().merge(operation, 1, Integer::sum);</span>
<span class="fc" id="L49">        dbMetrics.getOperationTimes().merge(operation, timeTaken, Long::sum);</span>
<span class="fc" id="L50">    }</span>

    /**
     * Retrieves the metrics for a specific API.
     *
     * @param apiEndpoint The API endpoint to retrieve metrics for.
     * @return A formatted response object containing metrics.
     */
    public static ApiMetricsResponse getApiMetrics(String apiEndpoint) {
<span class="fc" id="L59">        ApiMetrics apiMetrics = apiMetricsMap.getOrDefault(apiEndpoint, new ApiMetrics());</span>
<span class="fc" id="L60">        return apiMetrics.toResponse();</span>
    }

    /**
     * Clears all stored metrics (optional, for resetting metrics).
     */
    public static void resetMetrics() {
<span class="fc" id="L67">        apiMetricsMap.clear();</span>
<span class="fc" id="L68">    }</span>

    // Inner class representing metrics for a specific API
<span class="fc" id="L71">    private static class ApiMetrics {</span>
<span class="fc" id="L72">        private int apiCallCount = 0;</span>
<span class="fc" id="L73">        private final Map&lt;String, DbMetrics&gt; dbMetricsMap = new ConcurrentHashMap&lt;&gt;();</span>

        public void incrementApiCallCount() {
<span class="fc" id="L76">            apiCallCount++;</span>
<span class="fc" id="L77">        }</span>

        public Map&lt;String, DbMetrics&gt; getDbMetricsMap() {
<span class="fc" id="L80">            return dbMetricsMap;</span>
        }

        public ApiMetricsResponse toResponse() {
<span class="fc" id="L84">            ApiMetricsResponse response = new ApiMetricsResponse();</span>
<span class="fc" id="L85">            response.setApiCallCount(apiCallCount);</span>
<span class="fc" id="L86">            response.setCassandraMetrics(dbMetricsMap.getOrDefault(&quot;cassandra&quot;, new DbMetrics()).toResponse());</span>
<span class="fc" id="L87">            response.setRedisMetrics(dbMetricsMap.getOrDefault(&quot;redis&quot;, new DbMetrics()).toResponse());</span>
<span class="fc" id="L88">            response.setElasticsearchMetrics(dbMetricsMap.getOrDefault(&quot;elasticsearch&quot;, new DbMetrics()).toResponse());</span>
<span class="fc" id="L89">            response.setPostgresMetrics(dbMetricsMap.getOrDefault(&quot;postgres&quot;, new DbMetrics()).toResponse());</span>
<span class="fc" id="L90">            return response;</span>
        }
    }

    // Inner class representing database-specific metrics
<span class="fc" id="L95">    private static class DbMetrics {</span>
<span class="fc" id="L96">        private final Map&lt;String, Integer&gt; operationCounts = new HashMap&lt;&gt;();</span>
<span class="fc" id="L97">        private final Map&lt;String, Long&gt; operationTimes = new HashMap&lt;&gt;();</span>

        public Map&lt;String, Integer&gt; getOperationCounts() {
<span class="fc" id="L100">            return operationCounts;</span>
        }

        public Map&lt;String, Long&gt; getOperationTimes() {
<span class="fc" id="L104">            return operationTimes;</span>
        }

        public DbMetricsResponse toResponse() {
<span class="fc" id="L108">            DbMetricsResponse response = new DbMetricsResponse();</span>
<span class="fc" id="L109">            response.setInsertCount(operationCounts.getOrDefault(&quot;insert&quot;, 0));</span>
<span class="fc" id="L110">            response.setUpdateCount(operationCounts.getOrDefault(&quot;update&quot;, 0));</span>
<span class="fc" id="L111">            response.setReadCount(operationCounts.getOrDefault(&quot;read&quot;, 0));</span>
<span class="fc" id="L112">            response.setDeleteCount(operationCounts.getOrDefault(&quot;delete&quot;, 0));</span>

<span class="fc" id="L114">            response.setTotalInsertTime(operationTimes.getOrDefault(&quot;insert&quot;, 0L));</span>
<span class="fc" id="L115">            response.setTotalUpdateTime(operationTimes.getOrDefault(&quot;update&quot;, 0L));</span>
<span class="fc" id="L116">            response.setTotalReadTime(operationTimes.getOrDefault(&quot;read&quot;, 0L));</span>
<span class="fc" id="L117">            response.setTotalDeleteTime(operationTimes.getOrDefault(&quot;delete&quot;, 0L));</span>
<span class="fc" id="L118">            return response;</span>
        }
    }

    // Response class representing metrics in the desired format
<span class="fc" id="L123">    public static class ApiMetricsResponse {</span>
        private int apiCallCount;
        private DbMetricsResponse cassandraMetrics;
        private DbMetricsResponse redisMetrics;
        private DbMetricsResponse elasticsearchMetrics;
        private DbMetricsResponse postgresMetrics;

        // Getters and setters
        public int getApiCallCount() {
<span class="fc" id="L132">            return apiCallCount;</span>
        }

        public void setApiCallCount(int apiCallCount) {
<span class="fc" id="L136">            this.apiCallCount = apiCallCount;</span>
<span class="fc" id="L137">        }</span>

        public DbMetricsResponse getCassandraMetrics() {
<span class="fc" id="L140">            return cassandraMetrics;</span>
        }

        public void setCassandraMetrics(DbMetricsResponse cassandraMetrics) {
<span class="fc" id="L144">            this.cassandraMetrics = cassandraMetrics;</span>
<span class="fc" id="L145">        }</span>

        public DbMetricsResponse getRedisMetrics() {
<span class="nc" id="L148">            return redisMetrics;</span>
        }

        public void setRedisMetrics(DbMetricsResponse redisMetrics) {
<span class="fc" id="L152">            this.redisMetrics = redisMetrics;</span>
<span class="fc" id="L153">        }</span>

        public DbMetricsResponse getElasticsearchMetrics() {
<span class="nc" id="L156">            return elasticsearchMetrics;</span>
        }

        public void setElasticsearchMetrics(DbMetricsResponse elasticsearchMetrics) {
<span class="fc" id="L160">            this.elasticsearchMetrics = elasticsearchMetrics;</span>
<span class="fc" id="L161">        }</span>

        public DbMetricsResponse getPostgresMetrics() {
<span class="nc" id="L164">            return postgresMetrics;</span>
        }

        public void setPostgresMetrics(DbMetricsResponse postgresMetrics) {
<span class="fc" id="L168">            this.postgresMetrics = postgresMetrics;</span>
<span class="fc" id="L169">        }</span>
    }

    // Response class for database-specific metrics
<span class="fc" id="L173">    public static class DbMetricsResponse {</span>
        private int insertCount;
        private int updateCount;
        private int readCount;
        private int deleteCount;
        private long totalInsertTime;
        private long totalUpdateTime;
        private long totalReadTime;
        private long totalDeleteTime;

        // Getters and setters
        public int getInsertCount() {
<span class="fc" id="L185">            return insertCount;</span>
        }

        public void setInsertCount(int insertCount) {
<span class="fc" id="L189">            this.insertCount = insertCount;</span>
<span class="fc" id="L190">        }</span>

        public int getUpdateCount() {
<span class="nc" id="L193">            return updateCount;</span>
        }

        public void setUpdateCount(int updateCount) {
<span class="fc" id="L197">            this.updateCount = updateCount;</span>
<span class="fc" id="L198">        }</span>

        public int getReadCount() {
<span class="fc" id="L201">            return readCount;</span>
        }

        public void setReadCount(int readCount) {
<span class="fc" id="L205">            this.readCount = readCount;</span>
<span class="fc" id="L206">        }</span>

        public int getDeleteCount() {
<span class="nc" id="L209">            return deleteCount;</span>
        }

        public void setDeleteCount(int deleteCount) {
<span class="fc" id="L213">            this.deleteCount = deleteCount;</span>
<span class="fc" id="L214">        }</span>

        public long getTotalInsertTime() {
<span class="fc" id="L217">            return totalInsertTime;</span>
        }

        public void setTotalInsertTime(long totalInsertTime) {
<span class="fc" id="L221">            this.totalInsertTime = totalInsertTime;</span>
<span class="fc" id="L222">        }</span>

        public long getTotalUpdateTime() {
<span class="nc" id="L225">            return totalUpdateTime;</span>
        }

        public void setTotalUpdateTime(long totalUpdateTime) {
<span class="fc" id="L229">            this.totalUpdateTime = totalUpdateTime;</span>
<span class="fc" id="L230">        }</span>

        public long getTotalReadTime() {
<span class="fc" id="L233">            return totalReadTime;</span>
        }

        public void setTotalReadTime(long totalReadTime) {
<span class="fc" id="L237">            this.totalReadTime = totalReadTime;</span>
<span class="fc" id="L238">        }</span>

        public long getTotalDeleteTime() {
<span class="nc" id="L241">            return totalDeleteTime;</span>
        }

        public void setTotalDeleteTime(long totalDeleteTime) {
<span class="fc" id="L245">            this.totalDeleteTime = totalDeleteTime;</span>
<span class="fc" id="L246">        }</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>